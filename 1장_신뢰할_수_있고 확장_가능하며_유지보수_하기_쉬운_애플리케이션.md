# 1장 신뢰할 수 있고 확장 가능하며 유지보수 하기 쉬운 애플리케이션

## 데이터 시스템에 대한 생각

메인 데이터베이스와 분리된 애플리케이션 관리 캐시 계층이나 엘라스틱서치, 솔라 같은 전문 검색 서버의 경우 메인 데이터 베이스와 동기화된 데이터를 유지하는 것은 보통 애플리케이션 코드의 책임이다.

즉, 개발자는 애플리케이션 개발자뿐만 아니라 데이터 시스템 설계자 이기도 하다.

데이터 시스템이나 서비스를 설계할 때 까다로운 문제가 많이 생긴다.

내부적으로 문제가 있어도 데이터를 정확하고 완전하게 유지하려면 어떻게 해야 할까?

시스템의 일부 성능이 저하되더라도 클라이언트에 일관되게 좋은 성능을 어떻게 제공할 수 있을까?

부하 증가를 다루기 위해 어떻게 규모를 확장할까?

서비스를 위해 좋은 API는 어떤 모습일까?

### 소프트웨어 시스템에서 중요하게 여기는 세 가지 관심사

1. 신뢰성 Reliablility
    
    결함, 오류같은 역경에 직면하더라도 시스템은 지속적으로 올바르게 동작해야한다.
    
2. 확장성  Scalability
    
    데이터,트래픽,복잡도가 증가하면서 이를 처리할 수 있는 적절한 방법이 있어야 한다.
    
3. 유지보수성 Maintainability
    
    다양한 사람들이 시스템상에서 작업할 것이기 때문에 모든 사용자가 생산적으로 작업할 수 있게 해야 한다.
    

## 1. 신뢰성

잘못될 수 있는 일 = 결함

결함을 예측하고 대처할 수 있는 시스템 = 내결함성, 탄력성

결함은 장애와 동일하지 않다.

결함 = 사양에서 벗어난 시스템의 한 구성 요소

장애 = 사용자에게 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우

결함 확률을 0으로 줄이는 것은 불가능

### 하드웨어 결함

전문가들에 의하면 그리고 집계에 의하면 흔히 있는 일이다.

대응1. 각 하드웨어 구성 요소에 중복을 추가하는 방법

- 디스크는 RAID 구성으로 설치
- 서버는 이중 전원 디바이스와 핫 스왑 가능한 CPU
- 데이터센터는 건전지와 예비 전원용 디젤 발전기 갖추기

오늘날은 데이터 양이 늘어나면서 비례하게 하드웨어 결함율도 증가

클라우드플랫폼 사용 증가 (신뢰성 < 유연성, 탄력성)

### 중요하지 않은 애플리케이션도 사용자에 대한 책임이 있다.

## 2. 확장성

성능저하의 흔한 이유중 하나가 부하 증가

확장성을 논한다는 것은 yes no 가 아닌, 대처에 대한 고민한다는 의미

### 부하기술하기

현재의 부하를 간결하게 기술해야 그다음 을 논의할 수 있다.

부하는 부하매개변수라 부르는 몇 개의 숫자로 나타낼 수 있다.

부하를 기술하면 부하가 증가할 때 어떤 일이 일어나는지 조사할 수 있다.

트위터예시

- 방법1.
    
    트위터 글 삽입 → 사용자 홈 타임라인 요청하면 팔로우 하는 모든 사람의 트윗을 찾아 시간순 정렬하여 합치기
    
- 방법2
    
    개별사용자의 홈 타임라인 캐시 유지 → 글 작성 시 팔로우하는사람을 모두 찾고 각각의 홈 타임라인 캐시에 새로운 트윗 삽입
    

트위터는 방법1 에서 질의부하문제로 방법2로 전환

하지만 팔로워가 너무많은 유명인은 이에 따른 부가작업 비용이 너무 커서 5초이내에 타임라인에 노출하게끔 고민

결과적으로 방법2를 사용하되 팔로워가 많은 유명인은 방법1을 사용

즉 하이브리드(혼합형)으로 바꿈

### 성능기술하기

지연시간과 응답시간

<aside>
💡 종종 같은 뜻으로 사용하지만 동일하지 않다. 응답시간은 클라이언트 관점에서 본 시간으로 요청을 처리하는 실제 시간(서비스 시간) 외에도 네트워크 지연과 큐 지연도 포함된다. 지연시간은 요청이 처리되길 기다리는 시간으로, 서비스를 기다리며 휴지 상태인 시간을 말한다.

</aside>

가끔 꽤 오래걸리는 특이값이 있다.

평균은 그다지 좋은 지표가 아니다.

평균보다는 백분위

가장 빠른시간부터 느린시간까지 정렬하면 중간 지점이 중앙값

사용자가 보통 얼마나 오랫동안 기다려야 하는지 알고싶다면 중앙값이 좋은 지표

중앙값 = 50분위 = p50

사용자가 여러개의 요청을 보내면 중앙값보다 느릴 확률이 50%보다 훨씬높음

특이값이 얼마나 안좋은지 알아보는 것은 p95, p99, p999

꼬리지연시간으로 알려진 상위 백분위 응답시간은 서비스의 사용자 경험에 직접 영향을 주기 때문에 중요하다.

보통 응답시간이 느린 요청을 경험한 고객은 많이 이용해서 많은 데이터를 가지고 있기 때문

이 고객을 행복하게 만드는것이 중요하다

큐 대기 지연

소수의 느린 요청처리만으로도 후속 요청 처리가 지체 = 선두 차단(head-of-line blocking)

### 부하 대응 접근방식

탄력적인 시스템

부하를 예측할 수 없을만큼 높은 경우 유용하지만

수동으로 확장하는 시스템이 더 간단하고 운영상 예상치 못한 일이 더 적다 (209쪽 파티션 재균형화)

분산 시스템이 향후 기본 아키텍처로 자리잡을 가능성이 있다.

모든상황에 맞는 확장 아키텍처는 없다. 해당 시스템을 사용하는 애플리케이션에 특화돼있다.

특정 애플리케이션에 적합한 확장성을 갖춘 아키텍처는 주요 동작이 무엇이고 잘 하지 않는 동작이 무엇인지에 대한 가정을 바탕으로 구축해야한다.

## 3. 유지보수성

- 운용성
- 단순성
- 발전성

### 운용성: 운영의 편리함 만들기

좋은 운영팀이 책임져야하는 항목들

- 시스템 모니터링 → 빠르게 서비스 복원
- 시스템 장애 성능저하 등의 문제의 원인을 추적
- 보안 패치 포함 최신상태로 유지
- 다른시스템의 상호 영향도 체크하여 미리 문제 차단
- 문제발생가능성 예측하여 미리 해결(예, 용량계획)
- 배포, 설정관리등을 위한 모범사례와 도구를 마련
- 애플리케이션을 특정 플랫폼에서 다른플랫폼으로 이동하는 등 복잡한 유지보수 태스크 수행
- 설정 변경으로 생기는 시스템 보안 유지보수
- 예측 가능한 운영과 안정적인 서비스 환경을 유지하기 위한 절차 정의
- 개인 인사이동에도 시스템에 대한 조직의 지식을 보존함

좋은 운영성

: 동일하게 반복되는 태스크를 쉽게 수행하게끔 만들어 운영팀이 고부가가치 활동에 노력을 집중한다는 의미

### 단순성: 복잡도 관리

복잡도가 증가하면 유지보수 비용이 증가

복잡도 증상(상태 공간의 급증, 모듈간 강한 커플링, 복잡한 의존성, 일관성 없는 명명과 용어, 성능문제해결을 목표로 한 해킹, 임시방편으로 문제를 해결한 특수사례 등)

예산과 일정이 초과

변경이생기면 버그위험증가

우발적 복잡도를 제거하기 위한 최상의 도구 ‘추상화’

### 발전성: 변화를 쉽게 만들기